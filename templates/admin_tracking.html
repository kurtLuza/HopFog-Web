{% extends "base.html" %}
{% block title %}Delivery Tracking{% endblock %}
{% block content %}
<div class="container-fluid px-4">
  <h1 class="mt-4">Delivery Tracking</h1>
  <ol class="breadcrumb mb-4">
    <li class="breadcrumb-item"><a href="/admin/messaging">Admin Messaging</a></li>
    <li class="breadcrumb-item active">Tracking</li>
  </ol>

  <div class="card mb-4">
    <div class="card-header"><i class="fas fa-chart-line me-1"></i>Broadcast Delivery Summary</div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-sm align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Type</th>
              <th>Severity</th>
              <th>Subject</th>
              <th>Status</th>
              <th>Total</th>
              <th>Queued</th>
              <th>Sent</th>
              <th>Delivered</th>
              <th>Read</th>
              <th>Failed</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for row in summaries %}
            <tr>
              <td>{{ row.b.id }}</td>
              <td>{{ row.b.msg_type }}</td>
              <td>{{ row.b.severity }}</td>
              <td class="text-truncate" style="max-width: 220px;">{{ row.b.subject }}</td>
              <td><span class="badge bg-dark">{{ row.b.status }}</span></td>
              <td>{{ row.total }}</td>
              <td>{{ row.queued }}</td>
              <td>{{ row.sent }}</td>
              <td>{{ row.delivered }}</td>
              <td>{{ row.read }}</td>
              <td>{{ row.failed }}</td>
              <td><a class="btn btn-sm btn-outline-primary" href="/admin/messaging/broadcasts/{{ row.b.id }}">Open</a></td>
            </tr>
            {% endfor %}
            {% if summaries|length == 0 %}
            <tr><td colspan="12" class="text-muted">No broadcasts to track yet.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      <div class="form-text">Delivery states are stored per recipient in <code>broadcast_recipients</code>.</div>
    </div>
  </div>
</div>
{% endblock %}
